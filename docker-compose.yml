services:
  claude-bridge:
    build: .
    container_name: claude-slack-docker
    restart: unless-stopped
    ports:
      - "9876:9876"
    env_file:
      - .env
    environment:
      - CLAUDE_WORKING_DIR=/workspace
      - CLAUDE_SLACK_BRIDGE_URL=http://localhost:9876
      # Use OAuth token for Claude Code SDK authentication
      - CLAUDE_CODE_OAUTH_TOKEN=${ANTHROPIC_API_KEY}
    volumes:
      # Configuration
      - ./config.yaml:/app/config.yaml:ro
      - ./hooks:/app/hooks:ro

      # Claude config directory (for API key, settings)
      - claude-config:/home/claude/.claude

      # ============================================
      # WORKSPACE VOLUME MOUNTS
      # ============================================
      # Mount your repos here. Each repo gets its own directory.
      # Claude Code will have access to these directories.
      #
      # Format: /path/on/host:/workspace/name
      #
      # Examples (uncomment and modify):
      # - ~/GitHub/my-project:/workspace/my-project
      # - ~/GitHub/another-repo:/workspace/another-repo
      # - ~/work/client-project:/workspace/client-project
      # ============================================

      # Default: mount the entire GitHub folder (convenient but less isolated)
      # - ~/GitHub:/workspace

      # Or mount specific repos individually:
      # - ~/GitHub/repo1:/workspace/repo1
      # - ~/GitHub/repo2:/workspace/repo2

      # Mounted repos
      - ~/GitHub/claude-slack-bridge:/workspace/claude-slack-bridge
      - ~/GitHub/ai-adhoc:/workspace/ai-adhoc
      - ~/GitHub/claude-slack-docker:/workspace/claude-slack-docker

    # Increase shared memory for PTY operations
    shm_size: '256m'

    # Keep stdin open for PTY
    stdin_open: true
    tty: true

volumes:
  claude-config:
    name: claude-slack-docker-config
